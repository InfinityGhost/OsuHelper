<Window
    x:Class="OsuHelper.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="osu!helper v{0}"
    Width="850"
    Height="625"
    Background="{DynamicResource MaterialDesignPaper}"
    DataContext="{Binding MainViewModel, Source={StaticResource Locator}}"
    FontFamily="{DynamicResource MaterialDesignFont}"
    Icon="/osu!helper;component/favicon.ico"
    SnapsToDevicePixels="True"
    TextElement.FontSize="13"
    TextElement.FontWeight="Regular"
    TextElement.Foreground="{DynamicResource SecondaryTextBrush}"
    TextOptions.TextFormattingMode="Ideal"
    TextOptions.TextRenderingMode="Auto"
    WindowStartupLocation="CenterScreen">
    <materialDesign:DialogHost CloseOnClickAway="True">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!--  Toolbar  -->
            <Border
                Grid.Column="0"
                Background="{DynamicResource PrimaryHueMidBrush}"
                IsEnabled="{Binding IsBusy, Converter={StaticResource InvertBoolConverter}}"
                TextElement.Foreground="{DynamicResource SecondaryInverseTextBrush}">
                <StackPanel Orientation="Vertical">
                    <!--  Buttons  -->
                    <UniformGrid
                        Margin="5"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Rows="1">
                        <Button
                            x:Name="ShowSettingsDialogButton"
                            Margin="5,0,5,0"
                            Click="ShowSettingsDialogButton_OnClick"
                            Style="{DynamicResource MaterialDesignFlatDarkButton}">
                            <materialDesign:PackIcon
                                Width="24"
                                Height="24"
                                Kind="Settings" />
                        </Button>
                        <Button
                            Margin="5,0,5,0"
                            Command="{Binding GetRecommendationsCommand}"
                            Style="{DynamicResource MaterialDesignFlatDarkButton}">
                            <materialDesign:PackIcon
                                Width="24"
                                Height="24"
                                Kind="Reload" />
                        </Button>
                    </UniformGrid>

                    <!--  Progress bar  -->
                    <ProgressBar Background="Transparent" IsIndeterminate="{Binding IsBusy}" />
                </StackPanel>
            </Border>

            <!--  Recommendations  -->
            <DataGrid
                Grid.Row="1"
                Background="{DynamicResource MaterialDesignCardBackground}"
                HorizontalScrollBarVisibility="Disabled"
                IsEnabled="{Binding IsBusy, Converter={StaticResource InvertBoolConverter}}"
                ItemsSource="{Binding Recommendations}"
                VerticalScrollBarVisibility="Auto">
                <DataGrid.Style>
                    <Style BasedOn="{StaticResource {x:Type DataGrid}}" TargetType="{x:Type DataGrid}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsBusy}" Value="True">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard TargetProperty="Opacity">
                                            <DoubleAnimation
                                                From="1"
                                                To="0"
                                                Duration="0:0:0.5" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard TargetProperty="Opacity">
                                            <DoubleAnimation
                                                From="0"
                                                To="1"
                                                Duration="0:0:0.5" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.Style>
                <DataGrid.Columns>
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding Beatmap.FullName}"
                        Header="Name" />
                    <DataGridTextColumn Binding="{Binding Mods, Converter={StaticResource EnabledModsToStringConverter}}" Header="Mods" />
                    <DataGridTextColumn Binding="{Binding TraitsWithMods.StarRating, StringFormat=\{0:0.#\}}" Header="SR">
                        <DataGridTextColumn.CellStyle>
                            <Style BasedOn="{StaticResource {x:Type DataGridCell}}" TargetType="{x:Type DataGridCell}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsStarRatingAffected}" Value="True">
                                        <Setter Property="Foreground" Value="DarkRed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Binding="{Binding TraitsWithMods.ApproachRate, StringFormat=\{0:0.#\}}" Header="AR">
                        <DataGridTextColumn.CellStyle>
                            <Style BasedOn="{StaticResource {x:Type DataGridCell}}" TargetType="{x:Type DataGridCell}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsApproachRateAffected}" Value="True">
                                        <Setter Property="Foreground" Value="DarkRed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Binding="{Binding TraitsWithMods.OverallDifficulty, StringFormat=\{0:0.#\}}" Header="OD">
                        <DataGridTextColumn.CellStyle>
                            <Style BasedOn="{StaticResource {x:Type DataGridCell}}" TargetType="{x:Type DataGridCell}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsOverallDifficultyAffected}" Value="True">
                                        <Setter Property="Foreground" Value="DarkRed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Binding="{Binding TraitsWithMods.BeatsPerMinute, StringFormat=\{0:N0\}}" Header="BPM">
                        <DataGridTextColumn.CellStyle>
                            <Style BasedOn="{StaticResource {x:Type DataGridCell}}" TargetType="{x:Type DataGridCell}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsBeatsPerMinuteAffected}" Value="True">
                                        <Setter Property="Foreground" Value="DarkRed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Binding="{Binding TraitsWithMods.Duration, Converter={StaticResource TimeSpanToShortStringConverter}}" Header="Length">
                        <DataGridTextColumn.CellStyle>
                            <Style BasedOn="{StaticResource {x:Type DataGridCell}}" TargetType="{x:Type DataGridCell}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsDurationAffected}" Value="True">
                                        <Setter Property="Foreground" Value="DarkRed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Binding="{Binding ExpectedAccuracy, StringFormat=\{0:P2\}}" Header="Accuracy" />
                    <DataGridTextColumn Binding="{Binding ExpectedPerformancePoints, StringFormat=\{0:N0\} pp}" Header="Gain" />
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </materialDesign:DialogHost>
</Window>